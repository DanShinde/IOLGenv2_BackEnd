{% load humanize %}

{# --- Main Modal for ALL AUTOMATION Remarks --- #}
<div class="modal fade" id="allRemarksModalAutomation" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-comments me-2"></i>All Remarks for Automation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% for remark in automation_remarks %}
                <div class="remark-item">
                    <div class="remark-avatar">{{ remark.added_by.username|slice:":1"|upper }}</div>
                    <div class="remark-content">
                        <div class="remark-header">
                            <div>
                                <strong class="remark-author">{{ remark.added_by.get_full_name|default:remark.added_by.username }}</strong>
                                <span class="badge bg-light text-dark ms-2">{{ remark.stage.name }}</span>
                            </div>
                            <small class="remark-timestamp">{{ remark.created_at|naturaltime }}</small>
                        </div>
                        <div class="remark-text my-2">{{ remark.text|linebreaksbr }}</div>
                        
                        {% if user == remark.added_by or user.is_staff %}
                        <div class="remark-actions">
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editRemarkModal{{ remark.id }}">Edit</button>
                            <form action="{% url 'tracker_delete_remark' remark.id %}" method="post" class="d-inline ms-1" onsubmit="return confirm('Are you sure you want to delete this remark?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-muted">No remarks found for automation stages.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{# --- Main Modal for ALL EMULATION Remarks --- #}
<div class="modal fade" id="allRemarksModalEmulation" tabindex="-1" aria-hidden="true">
    {# ... Similar structure as the Automation modal ... #}
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-comments me-2"></i>All Remarks for Emulation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {% for remark in emulation_remarks %}
                {# ... content is identical to the loop above ... #}
                <div class="remark-item">
                    <div class="remark-avatar">{{ remark.added_by.username|slice:":1"|upper }}</div>
                    <div class="remark-content">
                        <div class="remark-header">
                            <div>
                                <strong class="remark-author">{{ remark.added_by.get_full_name|default:remark.added_by.username }}</strong>
                                <span class="badge bg-light text-dark ms-2">{{ remark.stage.name }}</span>
                            </div>
                            <small class="remark-timestamp">{{ remark.created_at|naturaltime }}</small>
                        </div>
                        <div class="remark-text my-2">{{ remark.text|linebreaksbr }}</div>
                        
                        {% if user == remark.added_by or user.is_staff %}
                        <div class="remark-actions">
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editRemarkModal{{ remark.id }}">Edit</button>
                            <form action="{% url 'tracker_delete_remark' remark.id %}" method="post" class="d-inline ms-1" onsubmit="return confirm('Are you sure you want to delete this remark?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-muted">No remarks found for emulation stages.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{# --- Individual EDIT Modals for ALL remarks --- #}
{% for remark in automation_remarks %}{% include 'tracker/partials/edit_remark_modal.html' %}{% endfor %}
{% for remark in emulation_remarks %}{% include 'tracker/partials/edit_remark_modal.html' %}{% endfor %}