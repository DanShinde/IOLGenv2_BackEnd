{% extends 'tracker/base.html' %}
{% load static %}

{% block title %}Help & Documentation | Project Tracker{% endblock %}

{% block content %}
<style>
    /* Style for the sticky navigation */
    .help-nav {
        position: -webkit-sticky;
        position: sticky;
        top: 100px;
        align-self: flex-start;
    }
    .help-section {
        display: none;
    }
    .help-section.active {
        display: block;
        animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .help-section h3 {
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 10px;
        margin-bottom: 20px;
        color: var(--primary);
    }
    .help-section h5 {
        font-weight: 600;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: var(--dark);
    }
    .help-section .card-body {
        line-height: 1.7;
    }
    .help-nav .list-group-item.active {
        font-weight: 600;
        border-left-width: 4px;
    }
    blockquote {
        border-left: 4px solid #e9ecef;
        padding-left: 1rem;
        margin: 1rem 0;
        font-style: italic;
        color: #6c757d;
    }
    code {
        background-color: rgba(67, 97, 238, 0.1);
        color: var(--primary-dark);
        padding: 0.2em 0.4em;
        border-radius: 3px;
        font-size: 0.9em;
    }
    .img-placeholder {
        border: 1px solid #dee2e6;
    }
</style>

<div class="page-header">
    <h1 class="page-title"><i class="fas fa-question-circle me-2"></i>Help & Documentation</h1>
    <p class="page-subtitle">Your guide to using the Project Tracker application.</p>
</div>

<div class="row">
    <div class="col-md-3">
        <div class="help-nav">
            <div class="card">
                <div class="card-header fw-bold">On This Page</div>
                <div class="list-group list-group-flush">
                    <a href="#getting-started" class="list-group-item list-group-item-action"><i class="fas fa-rocket fa-fw me-2"></i>Getting Started</a>
                    <a href="#dashboard" class="list-group-item list-group-item-action"><i class="fas fa-tachometer-alt fa-fw me-2"></i>Dashboard</a>
                    <a href="#projects-list" class="list-group-item list-group-item-action"><i class="fas fa-list-ul fa-fw me-2"></i>Projects List</a>
                    <a href="#project-detail" class="list-group-item list-group-item-action"><i class="fas fa-info-circle fa-fw me-2"></i>Project Detail Page</a>
                    <a href="#project-reports" class="list-group-item list-group-item-action"><i class="fas fa-chart-bar fa-fw me-2"></i>Reports & Analysis</a>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div id="getting-started" class="help-section card mb-4">
            <div class="card-body">
                <h3><i class="fas fa-rocket text-primary me-2"></i>Getting Started: A Typical Workflow</h3>
                <p>Welcome to the Project Tracker! This application is designed to bring clarity, accountability, and real-time insights to your project management process. This guide will walk you through a typical project lifecycle from creation to analysis.</p>
                
                <h5>Step 1: Create a New Project</h5>
                <p>All work is organized by project. To begin, navigate to the <strong><a href="{% url 'tracker_new_project' %}">Add New Project</a></strong> page. You will be asked to fill in a few key details that form the foundation of your project record: the <strong>Project Code</strong> (a unique ID), the <strong>Customer Name</strong>, its financial <strong>Value</strong>, the <strong>SO Punch Date</strong> (the official start date), and the business <strong>Segment</strong> it belongs to.</p>

                <h5>Step 2: Update Progress on the Detail Page</h5>
                <p>The <strong>Project Detail Page</strong> is your primary workspace for managing a project's progress. Here, you'll find lists of predefined stages. The core workflow is to set a <code>Planned Date</code> for each stage, update its <code>Status</code> as work progresses, and critically, enter the <code>Actual Date</code> of completion. This data is the engine that drives all the performance metrics and reports in the application.</p>
                
                <h5>Step 3: Monitor with the Dashboard</h5>
                <p>The <strong>Dashboard</strong> offers a high-level "mission control" view of your entire portfolio. It's designed for daily check-ins to monitor key health indicators, spot long-running "chronic" projects that may need attention, and review the pipeline of recently created work.</p>

                <h5>Step 4: Analyze with Reports</h5>
                <p>The <strong>Reports Page</strong> is your tool for business intelligence. It allows you to "ask questions" of your project data. By combining various filters, you can uncover trends, identify systemic delays, and generate targeted data sets for meetings and strategic planning. Any report you generate can be instantly exported to PDF.</p>
            </div>
        </div>

        <div id="dashboard" class="help-section card mb-4">
            <div class="card-body">
                <h3><i class="fas fa-tachometer-alt text-primary me-2"></i>The Dashboard</h3>
                <p>The dashboard is your main landing page, designed for at-a-glance monitoring of the entire project landscape. Use the date filters at the top to focus on a specific period, such as "This Month" or a custom date range.</p>
                <img src="{% static 'tracker_static/project_KPIs.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Project KPI Screenshot">
                
                <h5>Chronic Projects & Recently Created Projects</h5>
                <p>These tables automatically highlight important projects. The "Chronic Projects" table is particularly useful for identifying projects that may be stalled or forgotten, while the "Recently Created Projects" table shows the latest additions to the portfolio. Both tables feature live column filtering to help you find information quickly.</p>
                <img src="{% static 'tracker_static/chronic_projects.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Chronic Projects Screenshot">
                
                <ul>
                    <li><strong>How it Works:</strong> To quickly find an item in either table, simply type into an input field located directly below a column header (e.g., "Filter Code..."). The table will instantly update as you type to show only matching rows, without needing to reload the page.</li>
                </ul>
                <img src="{% static 'tracker_static/text_filter.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Text Filter Screenshot"> 
            </div>
        </div>

        <div id="projects-list" class="help-section card mb-4">
            <div class="card-body">
                <h3><i class="fas fa-list-ul text-primary me-2"></i>Projects List</h3>
                <p>While the dashboard provides a summary, the "Projects" page is the complete, unfiltered repository of every project in the system. It serves as the single source of truth for all projects, regardless of status or age.</p>
                <h5>Live Column Filtering</h5>
                <p>The most powerful feature of this page is the live filtering. Use the input fields at the top of the table to instantly search the entire project database. You can even combine filters. For example, to find all "In Progress" projects for "ABC Corp", type "ABC Corp" in the Customer filter, and then type "In Progress" in the Status filter. The list will narrow down with each keystroke.</p>
                <img src="{% static 'tracker_static/project_list.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Project List Screenshot">
            </div>
        </div>

        <div id="project-detail" class="help-section card mb-4">
            <div class="card-body">
                <h3><i class="fas fa-info-circle text-primary me-2"></i>Project Detail Page</h3>
                <p>This is the central hub where all detailed work on a single project is managed and tracked.</p>
                
                <h5>Project Timelines & Stages</h5>
                <p>The graphical roadmaps provide a quick visual summary of a project's progress. The solid green progress line is a key indicator, as it only advances to the last <strong>consecutively completed</strong> stage, giving you a true picture of committed progress. Below the timeline, the tabs for <strong>Automation</strong> and <strong>Emulation</strong> are where you perform the actual updates.</p>
                 <img src="{% static 'tracker_static/project_stages_timeline.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Project Stages Screenshot">

                <h5>Project Summary & Key Metrics</h5>
                <p>This card gives you a vital snapshot of the project's health. It includes schedule variance and two distinct OTIF (On-Time In-Full) metrics:</p>
                <ul>
                    <li><code>Overall OTIF % (All Stages)</code>: Think of this as the project's "term grade." It looks at every stage completed so far and calculates the percentage that met their planned deadline.</li>
                    <li><code>Project OTIF (Handover)</code>: Think of this as the project's "final exam." This metric focuses only on the final delivery and answers one question: was the project handed over on or before the promised date?</li>
                </ul>
                <img src="{% static 'tracker_static/project_summary.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Project Summary Screenshot">

                <h5>Recent Activity</h5>
                <p>This card provides a real-time feed of the last five changes made to any stage within this project. It shows what was changed, the old and new values, who made the change, and when it happened. For a complete audit trail, click the "View All" button in the corner to navigate to a page with the full, unabridged history for the project.</p>
                <img src="{% static 'tracker_static/recent_activity.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Recent Activity Screenshot">
                <p>The full activity history page displays a detailed timeline of every change, as shown below.</p>
                <img src="{% static 'tracker_static/all_activities.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="All Activities Screenshot">

            </div>
        </div>
        
        <div id="project-reports" class="help-section card mb-4">
            <div class="card-body">
                <h3><i class="fas fa-chart-bar text-primary me-2"></i>Reports & Analysis</h3>
                <p>The reports page is the business intelligence hub of the application. It's designed to help you answer complex questions about your project data by building specific queries through multiple layers of filters.</p>
                
                <h5>A Multi-Layered Filtering Workflow Example</h5>
                <p>Imagine a manager asks: "Show me all high-value 'AMR' projects started this year that are currently on hold." Hereâ€™s how you would use the tools:</p>
                <ol>
                    <li>First, use the main <strong>"Filter Options"</strong> panel. You would select "AMR" from the Segments list, set the "SO Punch Date Range" for the current year, and set the "Value Range" Min field to "10".</li>
                    <li>Then, in the "Stage Specific Filters", find the row for a relevant stage and select "Hold" from the status dropdown. Click "Apply Filters".</li>
                    <li>The table now shows your specific dataset. If the list is still long, you can use the <strong>Live Column Filters</strong> to narrow it down further.</li>
                    <li>Finally, you can click on any project row to expand its <strong>Collapsible Summary</strong> and view its key stats without leaving the page.</li>
                </ol>
                 <img src="{% static 'tracker_static/report_filter.png' %}" class="img-fluid rounded my-3 img-placeholder" alt="Filter In Reports Screenshot">
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ... (The script for handling navigation remains the same) ...
    const navLinks = document.querySelectorAll('.help-nav .list-group-item');
    const helpSections = document.querySelectorAll('.help-section');

    function showSection(targetId) {
        navLinks.forEach(link => link.classList.remove('active'));
        helpSections.forEach(section => section.classList.remove('active'));
        const activeLink = document.querySelector(`.help-nav a[href="${targetId}"]`);
        if (activeLink) activeLink.classList.add('active');
        const targetSection = document.querySelector(targetId);
        if (targetSection) targetSection.classList.add('active');
    }

    const initialHash = window.location.hash || '#getting-started';
    showSection(initialHash);

    navLinks.forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            const targetId = this.getAttribute('href');
            showSection(targetId);
            history.pushState(null, null, targetId);
        });
    });
});
</script>
{% endblock %}