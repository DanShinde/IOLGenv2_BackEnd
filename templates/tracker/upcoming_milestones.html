{% extends 'tracker/base.html' %}

{% block title %}Upcoming Milestones{% endblock %}

{% block content %}
<div class="page-header mb-4">
    <h2 class="page-title"><i class="fas fa-calendar-alt me-2"></i>Upcoming Milestones</h2>
    <p class="page-subtitle">List of project milestones planned in the future</p>
</div>

<!-- Filter Buttons -->
<form method="get" class="mb-3 d-flex gap-2 flex-wrap">
    {% for label, value in filter_options %}
        <button type="submit" name="filter" value="{{ value }}"
            class="btn {% if filter_type == value %}btn-primary{% else %}btn-outline-primary{% endif %}">
            {{ label }}
        </button>
    {% endfor %}
</form>

<!-- Export Buttons -->
<div class="d-flex justify-content-end mb-3 gap-2">
    <a href="{% url 'tracker_export_milestones_excel' %}?filter={{ filter_type }}" class="btn btn-outline-success">
        <i class="fas fa-file-excel me-1"></i> Export Excel
    </a>
    <a href="{% url 'tracker_export_milestones_pdf' %}?filter={{ filter_type }}" class="btn btn-outline-danger">
        <i class="fas fa-file-pdf me-1"></i> Export PDF
    </a>
</div>


<div class="card">
    <div class="card-body p-0">
        {% if upcoming %}
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Project</th>
                        <th>Milestone</th>
                        <th>Status</th>
                        <th>Planned Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stage in upcoming %}
                   
                    <tr class="{% if stage.planned_date < today and stage.status != 'Completed' %}table-danger{% endif %}">    
                        <td>{{ stage.project.code }} - {{ stage.project.customer_name }}</td>
                        <td>{{ stage.name }}</td>
                        <td>
                            <span class="badge bg-secondary">{{ stage.status }}</span>
                        </td>
                        <td>{{ stage.planned_date|date:"M d, Y" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-4">
            <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
            <p class="text-muted">No upcoming milestones.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
