{% extends 'tracker/base.html' %}
{% load humanize %}

{% block title %}{{ project.code }} | Full Activity History{% endblock %}

{% block extra_css %}
<style>
    /* New styles for a cleaner vertical timeline */
    .timeline {
        position: relative;
        padding: 1rem 0;
        margin-left: 1rem;
    }
    .timeline:before {
        content: '';
        position: absolute;
        left: 18px;
        top: 0;
        bottom: 0;
        width: 3px;
        background-color: #e9ecef;
        border-radius: 3px;
    }
    .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
    }
    .timeline-icon {
        position: absolute;
        left: 0;
        top: 0;
        width: 40px;
        height: 40px;
        background-color: var(--primary);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
        border: 4px solid #f8fafd;
    }
    .timeline-content {
        margin-left: 60px;
        background-color: #f8fafd;
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid #e9ecef;
    }
</style>
{% endblock %}


{% block content %}
<div class="page-header mb-3">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title"><i class="fas fa-history me-2"></i>Activity History for {{ project.code }}</h1>
            <p class="page-subtitle">A complete log of all recorded changes to project stages</p>
        </div>
        <a href="{% url 'tracker_project_detail' project.id %}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Back to Project
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        {% if history_logs %}
        <div class="timeline">
            {% for log in history_logs %}
            <div class="timeline-item">
                <div class="timeline-icon">
                    <i class="fas fa-{% if log.field_name == 'status' %}exchange-alt{% elif 'Date' in log.field_name %}calendar-alt{% else %}info{% endif %}"></i>
                </div>
                <div class="timeline-content">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <strong class="text-dark">{{ log.stage.name }} - {{ log.field_name|title }} changed</strong>
                        <small class="text-muted">{{ log.changed_at|naturaltime }}</small>
                    </div>
                    <div class="d-flex align-items-center mt-1">
                        <span class="badge bg-light text-dark me-2">{{ log.old_value|default:"(empty)" }}</span>
                        <i class="fas fa-long-arrow-alt-right text-muted mx-2"></i>
                        <span class="badge bg-primary-soft text-primary">{{ log.new_value|default:"(empty)" }}</span>
                    </div>
                    <small class="text-muted d-block mt-2">By {{ log.changed_by.get_full_name|default:log.changed_by.username|default:"System" }} on {{ log.changed_at|date:"M d, Y, H:i" }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
            <p class="text-muted">No activity has been recorded for this project yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}